<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel de administración</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f4f6f9;margin:0;padding:20px}
h1{margin-bottom:10px}
section{background:#fff;padding:15px;border-radius:10px;margin-bottom:20px;box-shadow:0 4px 10px rgba(0,0,0,.08)}
label{display:block;margin-top:10px}
input,select,button{padding:8px;margin-top:5px;width:100%}
button{cursor:pointer;background:#0d2b45;color:#fff;border:none;border-radius:6px}
#mapaBox{position:relative;margin-top:10px;border:1px solid #ccc;max-width:800px}
#mapaBox img{width:100%;display:block}
.point{position:absolute;width:12px;height:12px;border-radius:50%;border:2px solid #fff;transform:translate(-50%,-50%);box-shadow:0 0 0 2px rgba(0,0,0,.2)}
.Disponible{background:#2ecc71}
.Reservado{background:#f1c40f}
.Vendido{background:#e74c3c}
ul{padding-left:18px}
</style>
</head>
<body>

<h1>Panel de administración</h1>

<section>
<h3>Agregar barrio</h3>
<label>Nombre</label>
<input id="bNombre">
<label>Descripción</label>
<input id="bDesc">
<label>Imagen del mapa (nombre de archivo)</label>
<input id="bImg" placeholder="ej: rincon.jpg">
<button onclick="agregarBarrio()">Agregar barrio</button>
</section>

<section>
<h3>Agregar lote</h3>
<label>Barrio</label>
<select id="selBarrio"></select>

<label>Número</label><input id="lNum">
<label>Metros</label><input id="lMetros">
<label>Precio</label><input id="lPrecio">
<label>Financiación (opcional)</label><input id="lFin">
<label>Estado</label>
<select id="lEstado">
<option>Disponible</option>
<option>Reservado</option>
<option>Vendido</option>
</select>

<p>Hacé click en el mapa para ubicar el lote:</p>
<div id="mapaBox"></div>

<button onclick="guardarLote()">Guardar lote</button>

<h4>Lotes del barrio</h4>
<ul id="listaLotes"></ul>
</section>

<section>
<h3>Descargar data.js</h3>
<button onclick="descargar()">Descargar data.js actualizado</button>
</section>

<script>
let BARRIOS = [];
let clickX=null, clickY=null;

function agregarBarrio(){
 const b={id:Date.now(),nombre:bNombre.value,descripcion:bDesc.value,imagenMapa:bImg.value,lotes:[]};
 BARRIOS.push(b);
 actualizarSelect();
 alert('Barrio agregado');
}

function actualizarSelect(){
 selBarrio.innerHTML='';
 BARRIOS.forEach((b,i)=>{
  const o=document.createElement('option');
  o.value=i; o.textContent=b.nombre;
  selBarrio.appendChild(o);
 });
 cargarMapa();
 mostrarLotesBarrio();
}

function cargarMapa(){
 mapaBox.innerHTML='';
 const b=BARRIOS[selBarrio.value];
 if(!b) return;
 const img=document.createElement('img');
 img.src=b.imagenMapa;
 mapaBox.appendChild(img);

 img.onload=()=>{
  mapaBox.onclick=e=>{
   const r=img.getBoundingClientRect();
   clickX=((e.clientX-r.left)/r.width)*100;
   clickY=((e.clientY-r.top)/r.height)*100;
   mostrarPreview();
  }
 }

 b.lotes.forEach(l=>dibujarPunto(l));
}

function mostrarPreview(){
 mapaBox.querySelectorAll('.preview').forEach(p=>p.remove());
 const p=document.createElement('div');
 p.className='point preview '+lEstado.value;
 p.style.left=clickX+'%';
 p.style.top=clickY+'%';
 mapaBox.appendChild(p);
}

lEstado.onchange=mostrarPreview;

function guardarLote(){
 if(clickX==null){alert('Primero ubicá el lote en el mapa');return}
 const b=BARRIOS[selBarrio.value];

 const lote={
  numero:lNum.value,
  metros:lMetros.value,
  precio:lPrecio.value,
  financiacion:lFin.value||null,
  imagen:null,
  estado:lEstado.value,
  x:clickX,
  y:clickY
 };

 b.lotes.push(lote);
 dibujarPunto(lote);
 mostrarLotesBarrio();

 alert('Lote agregado');
 clickX=clickY=null;
 mapaBox.querySelectorAll('.preview').forEach(p=>p.remove());
}

function dibujarPunto(l){
 const p=document.createElement('div');
 p.className='point '+l.estado;
 p.style.left=l.x+'%';
 p.style.top=l.y+'%';
 mapaBox.appendChild(p);
}

function mostrarLotesBarrio(){
 const lista=document.getElementById('listaLotes');
 lista.innerHTML='';
 const b=BARRIOS[selBarrio.value];
 if(!b) return;

 b.lotes.forEach(l=>{
  const li=document.createElement('li');
  li.textContent=`Lote ${l.numero} - ${l.estado} - $${l.precio}`;
  lista.appendChild(li);
 });
}

selBarrio.onchange=()=>{
 cargarMapa();
 mostrarLotesBarrio();
}

function descargar(){
 const txt='const BARRIOS = '+JSON.stringify(BARRIOS,null,2);
 const blob=new Blob([txt],{type:'text/javascript'});
 const a=document.createElement('a');
 a.href=URL.createObjectURL(blob);
 a.download='data.js';
 a.click();
}
</script>

</body>
</html>
