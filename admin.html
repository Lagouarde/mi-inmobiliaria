<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin Barrios y Lotes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f4f6f9;margin:0;padding:20px}
h1{color:#0d2b45}
section{background:#fff;padding:15px;border-radius:10px;margin-bottom:20px;box-shadow:0 3px 10px rgba(0,0,0,.1)}
label{display:block;margin-top:8px}
input,select,button{padding:6px;margin-top:4px}
button{cursor:pointer}
.lote-item{border:1px solid #ddd;padding:8px;margin:6px 0;border-radius:6px;display:flex;justify-content:space-between;align-items:center}
.lote-item small{color:#666}
.actions button{margin-left:5px}
pre{background:#111;color:#0f0;padding:10px;overflow:auto;border-radius:6px}
</style>
</head>
<body>

<h1>Panel de administración</h1>

<section>
<h21️⃣ Cargar data.js actual</h2>
<input type="file" id="fileInput" accept=".js">
<p>Subí tu data.js actual para poder editar los lotes.</p>
</section>

<section id="editor" style="display:none">
<h2>2️⃣ Editar lotes</h2>
<select id="selectBarrio"></select>
<div id="listaLotes"></div>
</section>

<section id="formEdicion" style="display:none">
<h2>✏️ Editar lote</h2>
<label>Número <input id="eNumero"></label>
<label>Metros <input id="eMetros"></label>
<label>Precio <input id="ePrecio"></label>
<label>Financiación <input id="eFinanciacion"></label>
<label>Estado
<select id="eEstado">
<option>Disponible</option>
<option>Reservado</option>
<option>Vendido</option>
</select></label>
<button onclick="guardarEdicion()">Guardar cambios</button>
<button onclick="cancelarEdicion()">Cancelar</button>
</section>

<section id="exportar" style="display:none">
<h2>3️⃣ Exportar nuevo data.js</h2>
<button onclick="exportarData()">Generar data.js</button>
<pre id="salida"></pre>
</section>

<script>
let BARRIOS = [];
let barrioActual = null;
let loteActual = null;

// Cargar archivo
document.getElementById('fileInput').addEventListener('change', e => {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = ev => {
    try{
      eval(ev.target.result);
      iniciar();
    }catch(err){
      alert('Error al leer data.js');
    }
  }
  reader.readAsText(file);
});

function iniciar(){
  document.getElementById('editor').style.display='block';
  document.getElementById('exportar').style.display='block';
  const sel = document.getElementById('selectBarrio');
  sel.innerHTML='';
  BARRIOS.forEach((b,i)=>{
    const o=document.createElement('option');
    o.value=i;o.textContent=b.nombre;
    sel.appendChild(o);
  });
  sel.onchange=()=>mostrarLotes(sel.value);
  mostrarLotes(0);
}

function mostrarLotes(idx){
  barrioActual = BARRIOS[idx];
  const cont = document.getElementById('listaLotes');
  cont.innerHTML='';
  barrioActual.lotes.forEach((l,i)=>{
    const div=document.createElement('div');
    div.className='lote-item';
    div.innerHTML=`<div><strong>Lote ${l.numero}</strong><br><small>$ ${l.precio} - ${l.estado}</small></div>`+
    `<div class='actions'><button onclick='editarLote(${i})'>Editar</button></div>`;
    cont.appendChild(div);
  });
}

function editarLote(i){
  loteActual = barrioActual.lotes[i];
  document.getElementById('formEdicion').style.display='block';
  eNumero.value=loteActual.numero;
  eMetros.value=loteActual.metros;
  ePrecio.value=loteActual.precio;
  eFinanciacion.value=loteActual.financiacion||'';
  eEstado.value=loteActual.estado;
}

function guardarEdicion(){
  loteActual.numero=eNumero.value;
  loteActual.metros=eMetros.value;
  loteActual.precio=ePrecio.value;
  loteActual.financiacion=eFinanciacion.value;
  loteActual.estado=eEstado.value;
  document.getElementById('formEdicion').style.display='none';
  mostrarLotes(selectBarrio.value);
}

function cancelarEdicion(){
  document.getElementById('formEdicion').style.display='none';
}

function exportarData(){
  const txt = 'const BARRIOS = '+JSON.stringify(BARRIOS,null,2);
  document.getElementById('salida').textContent = txt;
}
</script>

</body>
</html>
