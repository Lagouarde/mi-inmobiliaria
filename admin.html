<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel de Administración</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--azul:#0d2b45;}
*{box-sizing:border-box}
body{margin:0;font-family:Montserrat,sans-serif;background:#f2f4f7}
header{background:var(--azul);color:#fff;padding:16px;text-align:center;font-size:22px;font-weight:700}
.container{max-width:1100px;margin:30px auto;padding:0 16px}
.card{background:#fff;border-radius:14px;padding:20px;margin-bottom:20px;box-shadow:0 6px 18px rgba(0,0,0,.08)}
.card h2{margin-top:0;color:var(--azul)}
.row{display:flex;gap:12px;flex-wrap:wrap}
.row input,.row select{padding:8px;border-radius:6px;border:1px solid #ccc;flex:1}
button{background:var(--azul);color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer}
button:hover{opacity:.9}
.listado{margin-top:10px}
.item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #eee}
.item button{background:#c0392b}
small{color:#666}
</style>
</head>
<body>
<header>Panel de administración</header>
<div class="container">

<div class="card">
<h2>1. Cargar data.js</h2>
<input type="file" id="fileInput" accept=".js">
</div>

<div class="card">
<h2>2. Agregar barrio</h2>
<div class="row">
<input id="bNombre" placeholder="Nombre del barrio">
<input id="bDesc" placeholder="Descripción">
<input id="bImg" placeholder="Imagen del mapa (ej: mapa.jpg)">
<button onclick="agregarBarrio()">Agregar</button>
</div>
</div>

<div class="card">
<h2>3. Eliminar barrios</h2>
<div id="listaBarrios" class="listado"></div>
</div>

<div class="card">
<h2>4. Agregar lote a un barrio</h2>
<div class="row">
<select id="selectBarrio"></select>
<input id="lNumero" placeholder="Número lote">
<input id="lMetros" placeholder="Metros cuadrados">
<input id="lPrecio" placeholder="Precio">
<input id="lFinan" placeholder="Financiación (opcional)">
<select id="lEstado">
<option>Disponible</option>
<option>Reservado</option>
<option>Vendido</option>
</select>
</div>
<div class="row" style="margin-top:10px">
<input id="lX" placeholder="Posición X (%) ej: 45">
<input id="lY" placeholder="Posición Y (%) ej: 30">
<button onclick="agregarLote()">Agregar lote</button>
</div>
<small>Las posiciones X e Y son porcentajes sobre la imagen del mapa.</small>
</div>

<div class="card">
<h2>5. Descargar data.js actualizado</h2>
<button onclick="descargarData()">Descargar data.js</button>
</div>

</div>

<script>
let BARRIOS = [];

document.getElementById('fileInput').addEventListener('change', function(e){
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = () => {
    try{
      const text = reader.result.replace('const BARRIOS =','');
      BARRIOS = eval(text);
      actualizarUI();
      alert('data.js cargado correctamente');
    }catch(err){alert('Error leyendo data.js');}
  }
  reader.readAsText(file);
});

function agregarBarrio(){
  const nombre=bNombre.value.trim();
  const desc=bDesc.value.trim();
  const img=bImg.value.trim();
  if(!nombre||!img) return alert('Nombre e imagen obligatorios');
  BARRIOS.push({id:Date.now(),nombre,descripcion:desc,imagenMapa:img,lotes:[]});
  bNombre.value=bDesc.value=bImg.value='';
  actualizarUI();
}

function eliminarBarrio(id){
  if(!confirm('Eliminar barrio?')) return;
  BARRIOS=BARRIOS.filter(b=>b.id!==id);
  actualizarUI();
}

function agregarLote(){
  const idBarrio=selectBarrio.value;
  const barrio=BARRIOS.find(b=>b.id==idBarrio);
  if(!barrio) return;
  barrio.lotes.push({
    numero:lNumero.value,
    metros:lMetros.value,
    precio:lPrecio.value,
    financiacion:lFinan.value,
    imagen:null,
    estado:lEstado.value,
    x:parseFloat(lX.value),
    y:parseFloat(lY.value)
  });
  lNumero.value=lMetros.value=lPrecio.value=lFinan.value=lX.value=lY.value='';
  alert('Lote agregado');
}

function actualizarUI(){
  listaBarrios.innerHTML='';
  selectBarrio.innerHTML='';
  BARRIOS.forEach(b=>{
    const div=document.createElement('div');
    div.className='item';
    div.innerHTML=`<span>${b.nombre}</span><button onclick="eliminarBarrio(${b.id})">Eliminar</button>`;
    listaBarrios.appendChild(div);

    const opt=document.createElement('option');
    opt.value=b.id;
    opt.textContent=b.nombre;
    selectBarrio.appendChild(opt);
  });
}

function descargarData(){
  const contenido = 'const BARRIOS = '+JSON.stringify(BARRIOS,null,2);
  const blob=new Blob([contenido],{type:'application/javascript'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='data.js';
  a.click();
}
</script>
</body>
</html>
