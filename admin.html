<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin | Inmobiliaria</title>
  <style>
    body{font-family:Montserrat,Arial;background:#f2f4f7;margin:0}
    main{max-width:1200px;margin:auto;padding:30px}
    section{background:#fff;border-radius:16px;padding:20px;margin-bottom:25px;box-shadow:0 8px 20px rgba(0,0,0,.08)}
    h1,h2{color:#0d2b45}
    label{font-weight:600;display:block;margin-top:12px}
    input,select,textarea,button{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-top:6px}
    button{background:#0d2b45;color:#fff;font-weight:600;cursor:pointer;margin-top:16px}
    .mapa-container{position:relative;margin-top:15px}
    .mapa-container img{width:100%;border-radius:14px;display:block}
    .punto{position:absolute;width:16px;height:16px;border-radius:50%;transform:translate(-50%,-50%)}
    ul li{margin:6px 0}
    .btn-del{background:#c0392b;width:auto;padding:4px 10px;margin-left:10px;font-size:12px}
    pre{background:#111;color:#0f0;padding:12px;border-radius:10px;overflow:auto;font-size:12px}
  </style>
</head>
<body>
<main>
<h1>Panel de Administración</h1>

<section>
<h2>Crear barrio</h2>
<label>Nombre</label><input id="nombreBarrio">
<label>Descripción</label><textarea id="descBarrio"></textarea>
<label>Imagen mapa (ruta)</label><input id="imgBarrio">
<button onclick="crearBarrio()">Agregar barrio</button>
</section>

<section>
<h2>Barrios</h2>
<ul id="listaBarrios"></ul>
</section>

<section>
<h2>Agregar lote</h2>
<label>Barrio</label><select id="selectBarrio"></select>
<label>Número</label><input id="numLote">
<label>Metros</label><input id="metrosLote">
<label>Precio</label><input id="precioLote">
<label>Financiación (opcional)</label><input id="finLote">
<label>Imagen lote (opcional)</label><input id="imgLote">
<label>Estado</label>
<select id="estadoLote">
  <option>Disponible</option>
  <option>Reservado</option>
  <option>Vendido</option>
</select>
<p><strong>Click en el mapa para ubicar el lote</strong></p>
<div class="mapa-container" id="mapaContainer">
  <img id="mapaBarrio">
</div>
<button onclick="crearLote()">Agregar lote</button>
</section>

<section>
<h2>Lotes del barrio</h2>
<ul id="listaLotes"></ul>
</section>

<section>
<h2>Exportar data.js</h2>
<button onclick="exportar()">Generar</button>
<pre id="output"></pre>
</section>
</main>

<script src="data.js"></script>
<script>
let x=null,y=null;

function refrescar(){
  listaBarrios.innerHTML='';
  selectBarrio.innerHTML='';
  BARRIOS.forEach(b=>{
    listaBarrios.innerHTML+=`<li>${b.nombre}<button class='btn-del' onclick='borrarBarrio(${b.id})'>Eliminar</button></li>`;
    selectBarrio.innerHTML+=`<option value='${b.id}'>${b.nombre}</option>`;
  });
  cargarMapa();
}

function crearBarrio(){
  BARRIOS.push({id:Date.now(),nombre:nombreBarrio.value,descripcion:descBarrio.value,imagenMapa:imgBarrio.value,lotes:[]});
  refrescar();
}

function borrarBarrio(id){
  const i=BARRIOS.findIndex(b=>b.id===id);
  if(i>=0)BARRIOS.splice(i,1);
  refrescar();
}

function cargarMapa(){
  const barrio=BARRIOS.find(b=>b.id==selectBarrio.value);
  if(!barrio)return;
  mapaBarrio.src=barrio.imagenMapa;
  limpiarPuntos();
  barrio.lotes.forEach((l,i)=>dibujarPunto(l,i));
  listarLotes();
}

selectBarrio.onchange=cargarMapa;

mapaBarrio.onclick=e=>{
  const r=mapaBarrio.getBoundingClientRect();
  x=((e.clientX-r.left)/r.width)*100;
  y=((e.clientY-r.top)/r.height)*100;
};

function colorEstado(e){return e==='Disponible'?'#2ecc71':e==='Reservado'?'#f1c40f':'#e74c3c'}

function dibujarPunto(lote,index){
  const d=document.createElement('div');
  d.className='punto';
  d.style.left=lote.x+'%';
  d.style.top=lote.y+'%';
  d.style.background=colorEstado(lote.estado);
  d.title='Lote '+lote.numero;
  mapaContainer.appendChild(d);
}

function limpiarPuntos(){document.querySelectorAll('.punto').forEach(p=>p.remove())}

function crearLote(){
  const barrio=BARRIOS.find(b=>b.id==selectBarrio.value);
  if(!barrio||x===null)return alert('Seleccioná ubicación');
  barrio.lotes.push({
    numero:numLote.value,
    metros:metrosLote.value,
    precio:precioLote.value,
    financiacion:finLote.value||null,
    imagen:imgLote.value||null,
    estado:estadoLote.value,
    x,y
  });
  x=y=null;
  cargarMapa();
}

function listarLotes(){
  const barrio=BARRIOS.find(b=>b.id==selectBarrio.value);
  listaLotes.innerHTML='';
  if(!barrio)return;
  barrio.lotes.forEach((l,i)=>{
    listaLotes.innerHTML+=`<li>Lote ${l.numero} - ${l.estado}<button class='btn-del' onclick='borrarLote(${i})'>Eliminar</button></li>`;
  });
}

function borrarLote(i){
  const barrio=BARRIOS.find(b=>b.id==selectBarrio.value);
  barrio.lotes.splice(i,1);
  cargarMapa();
}

function exportar(){output.textContent='const BARRIOS = '+JSON.stringify(BARRIOS,null,2)}

refrescar();
</script>
</body>
</html>
