<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Barrios</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f4f6f8;margin:0;padding:20px}
h1{margin-bottom:10px}
.container{max-width:1200px;margin:auto}
.card{background:#fff;padding:15px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.1);margin-bottom:20px}
label{display:block;margin-top:10px;font-weight:bold}
input,select,button{padding:8px;margin-top:5px;width:100%}
button{cursor:pointer;border:none;border-radius:6px;background:#0d2b45;color:#fff;font-weight:bold}
button:hover{opacity:.9}
.flex{display:flex;gap:20px;flex-wrap:wrap}
.col{flex:1;min-width:280px}
.lote-item{border:1px solid #ccc;border-radius:6px;padding:8px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
.lote-item button{width:auto;padding:5px 10px;font-size:12px}
textarea{width:100%;height:150px}
.hidden{display:none}
</style>
</head>
<body>
<div class="container">
<h1>Panel de administración</h1>

<div class="card">
<label>Cargar data.js actual</label>
<input type="file" id="fileInput" accept=".js">
</div>

<div class="card hidden" id="panel">
<div class="flex">
<div class="col">
<label>Seleccionar barrio</label>
<select id="selectBarrio"></select>

<h3>Lotes</h3>
<div id="listaLotes"></div>
</div>

<div class="col">
<h3>Editar lote</h3>
<input type="hidden" id="loteIndex">
<label>Número</label>
<input id="numero">
<label>Metros</label>
<input id="metros">
<label>Precio</label>
<input id="precio">
<label>Financiación</label>
<input id="financiacion">
<label>Estado</label>
<select id="estado">
<option>Disponible</option>
<option>Reservado</option>
<option>Vendido</option>
</select>
<br><br>
<button onclick="guardarCambios()">Guardar cambios</button>
</div>
</div>
</div>

<div class="card hidden" id="exportCard">
<h3>Nuevo data.js generado</h3>
<textarea id="output"></textarea>
</div>
</div>

<script>
let BARRIOS_DATA=[];
let barrioActual=null;

fileInput.onchange=e=>{
 const file=e.target.files[0];
 const reader=new FileReader();
 reader.onload=()=>{
  const text=reader.result;
  const match=text.match(/const BARRIOS = ([\s\S]*);/);
  if(!match){alert('data.js inválido');return;}
  BARRIOS_DATA=JSON.parse(match[1]);
  cargarBarrios();
  panel.classList.remove('hidden');
 };
 reader.readAsText(file);
}

function cargarBarrios(){
 selectBarrio.innerHTML='';
 BARRIOS_DATA.forEach((b,i)=>{
  const opt=document.createElement('option');
  opt.value=i;opt.textContent=b.nombre;
  selectBarrio.appendChild(opt);
 });
 selectBarrio.onchange=()=>mostrarBarrio(selectBarrio.value);
 mostrarBarrio(0);
}

function mostrarBarrio(i){
 barrioActual=BARRIOS_DATA[i];
 renderLotes();
}

function renderLotes(){
 listaLotes.innerHTML='';
 barrioActual.lotes.forEach((l,i)=>{
  const div=document.createElement('div');
  div.className='lote-item';
  div.innerHTML=`Lote ${l.numero} - ${l.precio} <button onclick="editarLote(${i})">Editar</button>`;
  listaLotes.appendChild(div);
 });
 generarOutput();
}

function editarLote(i){
 const l=barrioActual.lotes[i];
 loteIndex.value=i;
 numero.value=l.numero||'';
 metros.value=l.metros||'';
 precio.value=l.precio||'';
 financiacion.value=l.financiacion||'';
 estado.value=l.estado||'Disponible';
}

function guardarCambios(){
 const i=loteIndex.value;
 if(i==='') return alert('Seleccione un lote');
 const l=barrioActual.lotes[i];
 l.numero=numero.value;
 l.metros=metros.value;
 l.precio=precio.value;
 l.financiacion=financiacion.value||null;
 l.estado=estado.value;
 renderLotes();
 alert('Lote actualizado');
}

function generarOutput(){
 const txt=`const BARRIOS = ${JSON.stringify(BARRIOS_DATA,null,2)};`;
 output.value=txt;
 exportCard.classList.remove('hidden');
}
</script>
</body>
</html>
